# Commit, Push, and Create PR

以下の手順で、変更をコミット、プッシュし、Pull Requestを作成してください：

## 実行手順

1. **変更の確認と分析**
   - `git status` で変更ファイルを確認
   - `git diff` で変更内容（staged/unstaged両方）を確認
   - `git log -3 --oneline` で最近のコミット履歴を確認し、コミットメッセージスタイルを把握

2. **変更のステージング**
   - すべての変更をステージング: `git add .`
   - 追加されるファイルに機密情報（.env、credentials.json、token.json等）が含まれていないか確認
   - 機密情報が含まれる場合は警告を表示し、それらを除外

3. **コミットメッセージの作成**
   - 変更内容を分析し、適切なコミットメッセージを作成
   - メッセージは以下の形式に従う：
     ```
     [カテゴリ] 変更内容の簡潔な説明

     - 変更点1
     - 変更点2
     - 変更点3

     🤖 Generated with [Claude Code](https://claude.com/claude-code)

     Co-Authored-By: Claude <noreply@anthropic.com>
     ```
   - カテゴリ例: [機能追加], [改善], [修正], [ドキュメント], [テスト], [リファクタリング], [セキュリティ]

4. **コミットの実行**
   - 作成したメッセージでコミット実行
   - エラーが発生した場合は原因を分析し、対処
   - pre-commitフックが失敗した場合は、その内容を確認し、適切に対応

5. **現在のブランチ確認**
   - `git branch --show-current` で現在のブランチ名を取得
   - mainまたはmasterブランチの場合は警告を表示

6. **プッシュの実行**
   - リモートブランチが存在しない場合: `git push -u origin <branch-name>`
   - リモートブランチが存在する場合: `git push`
   - プッシュが失敗した場合は原因を分析し、必要に応じて解決方法を提案

7. **Pull Requestの作成**
   - `gh pr create` でPRを作成
   - PRタイトル: コミットメッセージの1行目を使用
   - PR本文: 以下の形式で作成
     ```markdown
     ## 概要
     <変更内容の説明>

     ## 変更内容
     - 変更点1
     - 変更点2
     - 変更点3

     ## テスト
     - [ ] ローカルでテスト実行済み
     - [ ] コードレビュー準備完了

     ## 関連Issue
     <該当する場合はIssue番号を記載>

     🤖 Generated with [Claude Code](https://claude.com/claude-code)
     ```
   - PRが正常に作成されたら、PR URLを表示

8. **最終確認**
   - `git status` で作業ツリーがクリーンであることを確認
   - PR URLを明確に表示
   - 次のステップ（レビュー依頼等）を案内

## エラーハンドリング

- **コミット失敗時**: pre-commitフックのエラー内容を確認し、修正方法を提案
- **プッシュ失敗時**:
  - リモートとの差異がある場合: `git pull --rebase` を提案
  - 権限エラーの場合: 認証設定を確認
- **PR作成失敗時**:
  - gh CLIがインストールされていない場合: インストール方法を案内
  - 認証エラーの場合: `gh auth login` を実行
  - 既存PRがある場合: 既存PRのURLを表示

## 注意事項

- main/masterブランチへの直接プッシュは推奨しない
- 機密情報を含むファイルは絶対にコミットしない
- コミットメッセージは変更内容を正確に反映する
- PRの説明は他の開発者が理解できるよう詳細に記載

## 実行後の出力

最後に、以下の情報を見やすく整形して表示してください：

```
✅ コミット完了
   コミットハッシュ: <hash>
   メッセージ: <message>

✅ プッシュ完了
   ブランチ: <branch-name>
   リモート: origin

✅ Pull Request作成完了
   PR URL: <url>
   タイトル: <title>

📋 次のステップ:
   1. PR URLにアクセスしてレビューを依頼
   2. CI/CDのテスト結果を確認
   3. レビューコメントに対応
```
